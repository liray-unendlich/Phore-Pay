<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" name="viewport" content="width=device-width,initial-scale=1"/>
<title>Phore Pay</title>
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="js/jquery.qrcode.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/drawer/3.1.0/css/drawer.min.css">
<link rel="stylesheet" href="css/main.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/iScroll/5.1.3/iscroll.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/drawer/3.1.0/js/drawer.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<script>
  $(function() {
    $.getJSON('https://api.coinmarketcap.com/v1/ticker/phore/')
    .done(function(data) {
      if (data[0].id) {
        result = data[0].price_usd;
        var n = 1;
        rate = Math.floor(result * Math.pow(10, n)) / Math.pow(10, n);
        $('#rate').html("<b>"+rate+"</b>");
      } else {
        $('#rate').html("Can't fetch phore/usd rate.");
      }
    });
    setInterval(function(){
      $.getJSON('https://api.coinmarketcap.com/v1/ticker/phore/')
      .done(function(data) {
        if (data[0].id) {
          result = data[0].price_usd;
          var n = 1;
          rate = Math.floor(result * Math.pow(10, n)) / Math.pow(10, n);
          $('#rate').html("<b>"+rate+"</b>");
        } else {
          $('#rate').html("Can't fetch phore/usd rate.");
        }
      });
    }, 10000);
  $('#request').click(function() {
    if($("#fee").val()==""){
      alert("No input");
    } else if(!$("#fee").val().match(/^[0-9]+$/)) {
      alert("Only numeral");
    } else if($("#user").val()==""){
      alert("No input");
    }

    var fee = $("#fee").val();
    var n = 3;
    var user = $("#user").val();
    var bill = fee / result;
    $("#qrcode").html("");
    var charge = Math.ceil(bill * Math.pow(10, n)) / Math.pow(10, n);
    $('#bill').html("<b>"+charge+"</b>");
    var message = "@tipsensu tip phr " + charge + " " + user;
    var url = "twitter://post?message=" + encodeURIComponent(message);
    $("#url").html(url);
    $("#qrcode").qrcode({width: 200, height: 200, text: url});
    var target = document.getElementById("twitter");
    target.href = url;
    target.innerText = "Pay via Twitter";
  });
  $(document).ready(function() {
    $(".drawer").drawer();
  });
});
</script>
<body class="drawer drawer--right">
  <header>
    <div class="title" font-family="Arial" font-size=4>
      <img src="logo.png" width="40" height="46.4649" alt="Phore Pay" align="left" hspace="10"><h1 class="title">Phore Pay</h1>
    </div>
  </header>
  <header role="banner">
    <button type="button" class="drawer-toggle drawer-hamburger">
      <span class="sr-only">toggle navigation</span>
      <span class="drawer-hamburger-icon"></span>
    </button>
    <nav class="drawer-nav" role="navigation">
     <!-- ここからドロップダウンの中身 -->
     <ul class="drawer-menu">
       <li><a class="drawer-menu-item" href="english.html">TOP</a></li>
       <li class="drawer-dropdown">
         <a class="drawer-menu-item" href="#" data-toggle="dropdown" role="button" aria-expanded="false">Twitter<span class="drawer-caret"></span>
         </a>
         <ul class="drawer-dropdown-menu">
           <li><a class="drawer-dropdown-menu-item" href="index.html">Off chain(For newbie)</a></li>
           <li><a class="drawer-dropdown-menu-item" href="twitterwithdraw.html">On chain</a></li>
         </ul>
       </li>
       <li><a class="drawer-menu-item" href="linewithdraw.html">LINE</a></li>
       <li><a class="drawer-menu-item" href="">DISCORD(Under construction)</a></li>
       <li><a class="drawer-menu-item" href="https://phore.io">Phore Official</a></li>
       <li><a class="drawer-menu-item" href="https://sensu.tip">Sensu Official</a></li>
       <li><a class="drawer-menu-item" href="index.html">日本語</a></li>
     </ul>
     <!-- ここまでドロップダウンの中身 -->
    </nav>
  </header>
  <div>
    Current Phore rate: <span id="rate"></span> USD
  </div>
  <form>
    <div class="settings">
      <span class="set-title">Payment Configuration</span>
      <ul>
        <li class="fee" style="margin-top:-15px;">
          <label for="fee">Charge</label>:&nbsp;<input id="fee" type="text" size="10">&nbsp;USD
        </li>
        <li class="user">
          <label for="user">To</label>:&nbsp;<input id="user" type="text" size="10">&nbsp;
        </li>
      </ul>
      <p><big>Charge in Phore: <span id="bill"><b></b></span> PHR</big></p>
    </div>
  </form>
  <div>
    <input id="request" type="button" value="Request" style="WIDTH:200px; HEIGHT:50px">
  </div>
  <div class="howpay">
    <span class="how-title">How To Pay</span>
    <p>
      1. Input amount of payment, destination(Twitter name).<br>
      2. Click "Request" button<br>
      3. If you are buyer<br>
      　 Click "Pay via Twitter" button to pay.<br>
      　 If no, Read below QR code and tweet.<br>
      4. Check the payment in Reply in Twitter app.<br>
    </p>
  </div>
  <div>
    <a class="link_button" id="twitter"></a>
  </div>
  <div id="qrcode" style="width:200px;height:200px;border:#d0d0d0 dashed 5px;margin-top:23px;"></div>

  <div class="howpay">
    <span class="how-title">Description</span>
    <p>
      This payment service uses Sensu https://sensu.tips . I'm glad to make this app for Sensu's developpers.<br>
      Please check whether you agree with Sensu's terms of service.
      Then check whether your twitter account linked to Sensu.
    </p>
  </div>
</body>
</html>